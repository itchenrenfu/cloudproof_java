package com.cosmian;

import cn.hutool.core.codec.Base64;

import com.cosmian.rest.abe.KmsClient;
import com.cosmian.utils.CloudproofException;
import com.fasterxml.jackson.databind.ObjectMapper;

import org.apache.commons.codec.DecoderException;
import org.apache.commons.codec.binary.Hex;
import org.junit.jupiter.api.Test;

/**
 * @author chenrenfu
 * @date 2024/8/21 14:26
 * @packageName:com.cosmian
 * @className: CertificateImportTest
 */
public class CertificateImportTest {
    private ObjectMapper mapper = new ObjectMapper();

    @Test
    public void test() throws CloudproofException {
        if (!TestUtils.serverAvailable(TestUtils.kmsServerUrl())) {
            throw new RuntimeException("Demo: No KMS Server available");
        }
        // 创建KmsClient
        final KmsClient kmsClient = new KmsClient(TestUtils.kmsServerUrl(), TestUtils.apiKey());
        String certificate =
                "MIIDyTCCArGgAwIBAgIUAtz5wklQnSnCjUME8zXN+ihUQe4wDQYJKoZIhvcNAQEL\n"
                        + "BQAwdDELMAkGA1UEBhMCQ04xDjAMBgNVBAgMBU5VSEFOMREwDwYDVQQHDAhDSEFO\n"
                        + "R1NIQTERMA8GA1UECgwIWkhPVUxVREExCjAIBgNVBAsMAWYxDDAKBgNVBAMMA2Vy\n"
                        + "dDEVMBMGCSqGSIb3DQEJARYGd2VyZXdyMB4XDTI0MDgxNTA3NDA1MVoXDTM0MDgx\n"
                        + "MzA3NDA1MVowdDELMAkGA1UEBhMCQ04xDjAMBgNVBAgMBU5VSEFOMREwDwYDVQQH\n"
                        + "DAhDSEFOR1NIQTERMA8GA1UECgwIWkhPVUxVREExCjAIBgNVBAsMAWYxDDAKBgNV\n"
                        + "BAMMA2VydDEVMBMGCSqGSIb3DQEJARYGd2VyZXdyMIIBIjANBgkqhkiG9w0BAQEF\n"
                        + "AAOCAQ8AMIIBCgKCAQEA0sQOGCeTnZC0WboRZ8JXrVhVpGgsKWFf/QrHZ56Jx/JH\n"
                        + "4AohPAcZpDiVHSj0QUv5ocwoO88jHM38tRbkq+nFT+c9BKjeCEy1E+8KXys3WZZq\n"
                        + "7lbSd7EVm0R8lK5NXH9EQ05d0focc5AfPHWQxQ1fzz9sFrwMpUV+zmfua8jqNiHT\n"
                        + "MIwPmE5LBu4tMy0DCWTvnh5nvohs2Q6/31/qyG1TXmWcVb1bGInsGNp2Kg3Z8AUT\n"
                        + "yytSKrs+0KlP+cAQQNbzVP8737NA40Xb9Im45YsXITlF+bi259CLoHFaTKF0fusi\n"
                        + "1PB+RvYJKyxCiiciBtu5SmclkO/kkCb3D3+kQZIAswIDAQABo1MwUTAdBgNVHQ4E\n"
                        + "FgQUysdqVCGggItiodxe8tGG07OrxMYwHwYDVR0jBBgwFoAUysdqVCGggItiodxe\n"
                        + "8tGG07OrxMYwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAJP4N\n"
                        + "gnP9amQzFU3aYHftjK+3mLez0kR1THELrIs7Cgy0AESqD2mxnj84ZXHRHPwa3ref\n"
                        + "XzvNu4NSE9zcOVwaiSKkcTvARTwDLuVAU+IKDBA2auk0C2qcvKHBPjmPsh2zPE3v\n"
                        + "OJYXD7ojFjTjsCUHanG3VeseIpM2TZVXI/kkvwZJhbj9kGXdvz8TXjRwbzZD0a3s\n"
                        + "SLSldLbiSZC94I5j6whwDAnYw4nkFBg4iOVCdaehkgn+NC1PjOLrBGvrEAjgkD/5\n"
                        + "DQcouLVYTjEotcZvDSIA1qo4OB9W5hXFEmlg9BWtdZvVOGbXCL0hIok1zV6t/lbz\n"
                        + "JkutEL76G3I5AB2UBA==\n";
        String certificateId = kmsClient.importCertificate("", "", certificate, false);
        System.out.println(certificateId);
    }

    @Test
    public void hexTest() throws DecoderException {
        String hex =
                "308203C9308202B1A003020102021402DCF9C249509D29C28D4304F335CDFA285441EE300D06092A864886F70D01010B05003074310B300906035504061302434E310E300C06035504080C054E5548414E3111300F06035504070C084348414E475348413111300F060355040A0C085A484F554C554441310A3008060355040B0C0166310C300A06035504030C036572743115301306092A864886F70D0109011606776572657772301E170D3234303831353037343035315A170D3334303831333037343035315A3074310B300906035504061302434E310E300C06035504080C054E5548414E3111300F06035504070C084348414E475348413111300F060355040A0C085A484F554C554441310A3008060355040B0C0166310C300A06035504030C036572743115301306092A864886F70D010901160677657265777230820122300D06092A864886F70D01010105000382010F003082010A0282010100D2C40E1827939D90B459BA1167C257AD5855A4682C29615FFD0AC7679E89C7F247E00A213C0719A438951D28F4414BF9A1CC283BCF231CCDFCB516E4ABE9C54FE73D04A8DE084CB513EF0A5F2B3759966AEE56D277B1159B447C94AE4D5C7F44434E5DD1FA1C73901F3C7590C50D5FCF3F6C16BC0CA5457ECE67EE6BC8EA3621D3308C0F984E4B06EE2D332D030964EF9E1E67BE886CD90EBFDF5FEAC86D535E659C55BD5B1889EC18DA762A0DD9F00513CB2B522ABB3ED0A94FF9C01040D6F354FF3BDFB340E345DBF489B8E58B17213945F9B8B6E7D08BA0715A4CA1747EEB22D4F07E46F6092B2C428A272206DBB94A672590EFE49026F70F7FA4419200B30203010001A3533051301D0603551D0E04160414CAC76A5421A0808B62A1DC5EF2D186D3B3ABC4C6301F0603551D23041830168014CAC76A5421A0808B62A1DC5EF2D186D3B3ABC4C6300F0603551D130101FF040530030101FF300D06092A864886F70D01010B0500038201010024FE0D8273FD6A6433154DDA6077ED8CAFB798B7B3D244754C710BAC8B3B0A0CB40044AA0F69B19E3F386571D11CFC1ADEB79F5F3BCDBB835213DCDC395C1A8922A4713BC0453C032EE54053E20A0C10366AE9340B6A9CBCA1C13E398FB21DB33C4DEF3896170FBA231634E3B025076A71B755EB1E2293364D955723F924BF064985B8FD9065DDBF3F135E34706F3643D1ADEC48B4A574B6E24990BDE08E63EB08700C09D8C389E414183888E54275A7A19209FE342D4F8CE2EB046BEB1008E0903FF90D0728B8B5584E3128B5C66F0D2200D6AA38381F56E615C5126960F415AD759BD53866D708BD21228935CD5EADFE56F3264BAD10BEFA1B7239001D9404";
        String certificate = Base64.encode(Hex.decodeHex(hex));

        System.out.println(certificate);

        System.out.println(Hex.encodeHexString(Base64.decode(certificate)));
    }
}
